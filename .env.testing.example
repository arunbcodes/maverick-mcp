# ============================================================================
# MaverickMCP Testing Environment Configuration
# ============================================================================
# Optimized for automated testing (CI/CD, unit tests, integration tests)
# Uses in-memory databases, mock APIs, and fast configurations
# ============================================================================

# ============================================================================
# REQUIRED - Minimum keys for testing
# ============================================================================

# Tiingo API Key (Use test/mock key for CI/CD)
# For local testing: use real key with low rate limit
# For CI/CD: use mock or vcr.py recordings
TIINGO_API_KEY=test_tiingo_key_for_automated_tests

# ============================================================================
# TESTING SETTINGS
# ============================================================================

# Environment
ENVIRONMENT=testing
LOG_LEVEL=warning

# API Server Settings
API_HOST=127.0.0.1
API_PORT=8000

# Testing Mode
DEBUG=false
HOT_RELOAD=false
AUTO_RELOAD=false
TESTING=true

# ============================================================================
# DATABASE CONFIGURATION
# ============================================================================

# In-memory SQLite for fast testing (ephemeral)
DATABASE_URL=sqlite:///:memory:

# Or persistent test database
# DATABASE_URL=sqlite:///test_maverick_mcp.db

# For integration tests requiring PostgreSQL
# DATABASE_URL=postgresql://postgres:postgres@localhost:55432/maverick_mcp_test

# Test database configuration
DB_POOL_SIZE=5
DB_MAX_OVERFLOW=0
DB_ECHO=false

# ============================================================================
# REDIS CACHE (Mock for testing)
# ============================================================================

# Use in-memory cache for testing (no Redis required)
# REDIS_HOST=localhost
# REDIS_PORT=56379
# REDIS_URL=redis://localhost:56379/1

# Or use fakeredis for testing
USE_FAKE_REDIS=true

# ============================================================================
# OPTIONAL API KEYS (Mock values for testing)
# ============================================================================

# Mock keys for testing (won't make real API calls)
OPENROUTER_API_KEY=test_openrouter_key
EXA_API_KEY=test_exa_key
OPENAI_API_KEY=test_openai_key
ANTHROPIC_API_KEY=test_anthropic_key
FRED_API_KEY=test_fred_key
TAVILY_API_KEY=test_tavily_key

# ============================================================================
# TESTING PERFORMANCE SETTINGS
# ============================================================================

# Minimal resources for fast tests
WORKERS=1
MAX_CONNECTIONS=5
TIMEOUT=10

# Fast cache (short TTL)
CACHE_TTL=60
ENABLE_QUERY_CACHE=false

# No rate limiting in tests
RATE_LIMIT_ENABLED=false

# ============================================================================
# TESTING & MOCKING
# ============================================================================

# Mock external APIs to avoid rate limits
MOCK_EXTERNAL_APIS=true
MOCK_TIINGO=true
MOCK_OPENROUTER=true
MOCK_EXA=true

# VCR.py cassette mode
VCR_RECORD_MODE=once
VCR_MATCH_ON=uri,method

# Test data seeding
SEED_TEST_DATA=true
TEST_DATA_PATH=./tests/fixtures/test_data.json

# ============================================================================
# TEST ISOLATION
# ============================================================================

# Clean database before each test
CLEAN_DB_BEFORE_TESTS=true
CLEAN_CACHE_BEFORE_TESTS=true

# Transaction rollback after each test
USE_TEST_TRANSACTIONS=true
ROLLBACK_AFTER_TEST=true

# ============================================================================
# TEST COVERAGE & REPORTING
# ============================================================================

# Coverage settings
COVERAGE_ENABLED=true
COVERAGE_MIN=80
COVERAGE_REPORT=term-missing

# Test output
TEST_OUTPUT_DIR=./test-results
JUNIT_XML_OUTPUT=./test-results/junit.xml
HTML_REPORT_DIR=./test-results/html

# ============================================================================
# PARALLEL TESTING
# ============================================================================

# Number of parallel workers for pytest-xdist
TEST_WORKERS=auto
TEST_PARALLEL=true

# Test database per worker
TEST_DB_SUFFIX=_worker_{worker_id}

# ============================================================================
# INTEGRATION TEST SETTINGS
# ============================================================================

# Integration tests use testcontainers
USE_TESTCONTAINERS=true
TESTCONTAINER_POSTGRES_IMAGE=postgres:15-alpine
TESTCONTAINER_REDIS_IMAGE=redis:7-alpine

# Integration test timeouts
INTEGRATION_TEST_TIMEOUT=300
E2E_TEST_TIMEOUT=600

# ============================================================================
# CI/CD SPECIFIC SETTINGS
# ============================================================================

# GitHub Actions
CI=true
GITHUB_ACTIONS=false

# Disable features that don't work in CI
DISABLE_GPU=true
DISABLE_CUDA=true

# Simplified logging for CI
LOG_FORMAT=plain
LOG_TO_FILE=false

# ============================================================================
# DEBUGGING TESTS
# ============================================================================

# Show SQL queries in test output (for debugging failing tests)
SHOW_SQL_IN_TESTS=false

# Pause on test failure (for local debugging)
PAUSE_ON_FAILURE=false

# Keep test database after run (for inspection)
KEEP_TEST_DB=false

# Verbose test output
PYTEST_VERBOSE=false

# ============================================================================
# TESTING NOTES
# ============================================================================
#
# 1. Running Tests:
#    - Unit tests: `pytest -m "not integration"`
#    - Integration tests: `pytest -m integration`
#    - All tests: `pytest`
#    - With coverage: `pytest --cov=maverick_mcp`
#
# 2. Test Database:
#    - In-memory SQLite for unit tests (fast)
#    - PostgreSQL testcontainers for integration tests
#    - Database cleaned automatically between tests
#
# 3. Mocking:
#    - External APIs are mocked by default
#    - Use VCR.py cassettes for recorded API responses
#    - Toggle MOCK_EXTERNAL_APIS=false to test real APIs
#
# 4. Parallel Testing:
#    - Use `pytest -n auto` for parallel execution
#    - Each worker gets isolated database
#    - Speeds up test suite significantly
#
# 5. CI/CD:
#    - GitHub Actions automatically sets CI=true
#    - Tests run in isolated containers
#    - Coverage reports uploaded to Codecov
#
# 6. Test Isolation:
#    - Each test runs in transaction (rolled back after)
#    - Database schema reset between test modules
#    - Cache cleared between tests
#
# 7. Debugging:
#    - Set PYTEST_VERBOSE=true for detailed output
#    - Set SHOW_SQL_IN_TESTS=true to see queries
#    - Set PAUSE_ON_FAILURE=true to inspect state
#    - Set KEEP_TEST_DB=true to examine database after run
#
# ============================================================================
